{% extends "base.html" %}

{% block title %}Plan Your Trip{% endblock %}

{% block extra_head %}
<style>
  .page-layout {
    display: flex;
    flex-wrap: nowrap;
    gap: 2rem;
    margin-top: 3rem;
  }

  .form-column {
    flex: 0 0 40%;
    background-color: #ffffff;
    padding: 2rem;
    border-radius: 16px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    height: fit-content;
  }

  .form-column h2 {
    font-weight: 700;
    color: #0d6efd;
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .btn-submit {
    width: 100%;
    padding: 0.75rem;
    font-size: 1.1rem;
    border-radius: 8px;
  }

  .results-column {
    flex: 0 0 60%;
  }

  .trip-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }

  .trip-card {
    background-color: #f8f9fa;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    height: 100%;
    transition: transform 0.2s ease;
  }

  .trip-card:hover {
    transform: scale(1.015);
  }

  .trip-image {
    width: 100%;
    height: 160px;
    object-fit: cover;
  }

  .trip-info {
    padding: 1rem 1.25rem;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    flex-grow: 1;
  }

  .trip-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: #0d6efd;
    margin-bottom: 0.5rem;
  }

  .trip-meta {
    font-size: 0.9rem;
    color: #495057;
    margin-bottom: 0.3rem;
  }

  .book-button {
    margin-top: 0.8rem;
    width: 100%;
  }

  .no-trips {
    text-align: center;
    color: #dc3545;
    font-weight: bold;
    margin-top: 2rem;
  }

  @media (max-width: 991px) {
    .page-layout {
      flex-direction: column;
    }

    .form-column,
    .results-column {
      flex: 100%;
    }

    .trip-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="container page-layout">

  <div class="form-column">
    <h2>Plan Your Trip</h2>
    <form method="POST">
      {% csrf_token %}
      {{ form.non_field_errors }}
      <div class="mb-3">
        <label class="form-label">Start Destination</label>
        {{ form.start_destination }}
      </div>
      <div class="mb-3">
        <label class="form-label">End Destination</label>
        {{ form.end_destination }}
      </div>
      <div class="mb-3">
        <label class="form-label">Start Date</label>
        {{ form.start_date }}
      </div>
      <div class="mb-3">
        <label class="form-label">End Date</label>
        {{ form.end_date }}
      </div>
      <div class="mb-3">
        <label class="form-label">Number of People</label>
        {{ form.number_of_people }}
      </div>
      <button type="submit" name="search" class="btn btn-primary btn-submit">
        <i class="bi bi-search me-2"></i>Search Trips
      </button>
    </form>
  </div>

  <div class="results-column">
    {% if no_trips %}
      <div class="no-trips">No trips available for selected categories</div>
    {% endif %}

    {% if available_trips %}
      <h4 class="text-center mb-4">
        {% if form_submitted %}Matching Trips{% else %}Available Trips{% endif %}
      </h4>
      <div class="trip-grid">
        {% for trip in available_trips %}
          <div class="trip-card">
            {% if trip.picture_url %}
              <img src="{{ trip.picture_url }}" alt="{{ trip.name }}" class="trip-image">
            {% endif %}
            <div class="trip-info">
              <div>
                <div class="trip-title">{{ trip.name }}</div>
                <p class="trip-meta">{{ trip.description }}</p>
                <p class="trip-meta"><i class="bi bi-geo-alt me-1"></i>{{ trip.start_destination }} → {{ trip.end_destination }}</p>
                <p class="trip-meta"><i class="bi bi-calendar me-1"></i>{{ trip.start_date }} to {{ trip.end_date }}</p>
                <p class="trip-meta"><i class="bi bi-people me-1"></i>{{ trip.number_of_people }} people · ${{ trip.price }}</p>
              </div>
              <form method="POST">
                {% csrf_token %}
                <input type="hidden" name="book_trip_id" value="{{ trip.id }}">
                <input type="hidden" name="number_of_people" value="{{ form.number_of_people.value|default:1 }}">
                <button type="submit" class="btn btn-success book-button">
                  <i class="bi bi-check2-circle me-1"></i>Book Now
                </button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}

